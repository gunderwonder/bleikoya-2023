name: Deploy to bleikoya.net

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ssh.bleikoya.net
          username: bleikoya.net
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /www/wp-content/themes/bleikoya-2023
            git pull
            composer install --no-dev --optimize-autoloader

      - name: Send notification
        if: always()
        run: |
          if [ "${{ job.status }}" = "success" ]; then
            curl -d "Deploy fullfort: ${{ github.event.head_commit.message }}" ntfy.sh/${{ secrets.NTFY_TOPIC }}
          else
            curl -H "Priority: high" -H "Tags: warning" -d "Deploy FEILET: ${{ github.event.head_commit.message }}" ntfy.sh/${{ secrets.NTFY_TOPIC }}
          fi
# Test 1765052211
